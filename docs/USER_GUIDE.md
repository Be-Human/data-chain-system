# 📚 用户使用手册

欢迎使用区块链数据上链系统！本手册将指导您如何使用系统的各项功能。

## 目录

1. [准备工作](#准备工作)
2. [连接钱包](#连接钱包)
3. [数据上传](#数据上传)
4. [数据查询](#数据查询)
5. [交易管理](#交易管理)
6. [高级功能](#高级功能)
7. [费用说明](#费用说明)
8. [安全提示](#安全提示)

## 准备工作

### 1. 安装 MetaMask

1. 访问 [MetaMask 官网](https://metamask.io/)
2. 点击 "Download"
3. 选择您的浏览器（Chrome/Firefox/Edge）
4. 安装扩展程序
5. 创建新钱包或导入已有钱包

### 2. 获取测试币

#### Sepolia 测试网
1. 在 MetaMask 中切换到 Sepolia 网络
2. 复制您的钱包地址
3. 访问水龙头网站：
   - [Sepolia Faucet](https://sepoliafaucet.com/)
   - [Alchemy Sepolia Faucet](https://sepoliafaucet.com/)
4. 粘贴地址，领取测试 ETH
5. 等待 1-2 分钟到账

## 连接钱包

### 步骤说明

1. **打开网站**
   - 访问系统网址
   - 确保 MetaMask 已解锁

2. **点击连接**
   - 点击右上角 "Connect Wallet"
   - 选择 "MetaMask"

3. **确认连接**
   - 在 MetaMask 弹窗中查看权限
   - 点击 "连接"

4. **切换网络**
   - 如果不在 Sepolia 网络
   - MetaMask 会提示切换
   - 点击 "切换网络"

### 连接成功标志
- 右上角显示钱包地址
- 显示 ETH 余额
- 显示当前网络

## 数据上传

### 📝 方式一：日志上传

**适用场景**：纯数据存储，不涉及资金转移

**操作步骤**：
1. 选择 "📝 日志方式" 标签
2. 填写数据分类
   - 示例：`personal`、`business`、`document`
3. 输入数据内容
   - 支持文本、JSON、Base64 等
   - 最大长度：约 24KB
4. 点击 "上传到区块链"
5. MetaMask 确认：
   - 查看 Gas 费（约 0.001 ETH）
   - 点击 "确认"
6. 等待交易确认（约 15 秒）

**成功提示**：
- 页面显示 "✅ 上链成功！"
- 数据自动出现在列表中

### 🔒 方式二：合约转账

**适用场景**：转账并附带备注信息

**操作步骤**：
1. 选择 "🔒 合约转账" 标签
2. 输入接收地址
   - 可使用测试地址按钮
   - 确保地址格式正确（0x开头，42位）
3. 输入转账金额
   - 单位：ETH
   - 示例：0.001
4. 输入备注信息
   - 该信息会永久保存
   - 支持中英文
5. 点击 "通过合约转账"
6. MetaMask 确认：
   - 查看总金额（转账额 + Gas）
   - 确认接收地址
   - 点击 "确认"

**注意事项**：
- 资金通过合约中转
- 备注信息公开可见
- 不可撤销

### ⚡ 方式三：原生转账

**适用场景**：普通转账，可选附加数据

**操作步骤**：
1. 选择 "⚡ 原生转账" 标签
2. 输入接收地址
3. 输入转账金额
4. （可选）添加附加数据
   - 选择格式：文本或 Hex
   - 文本会自动转换为 Hex
5. 点击 "直接转账"
6. 确认交易

**特点**：
- Gas 费最低（21,000 Gas）
- 数据在交易 input data 中
- 需通过 Etherscan 查看数据

## 数据查询

### 🔒 合约数据

**位置**：数据中心 → 合约数据

**功能说明**：
- 显示所有通过合约上传的数据
- 包括日志方式和合约转账的数据
- 免费查询，不消耗 Gas

**操作方法**：
1. 自动加载最新数据
2. 点击 "显示更多" 查看历史记录
3. 使用刷新按钮更新数据

**数据内容**：
- 记录 ID
- 发送者地址
- 数据分类
- 数据内容
- 时间戳
- 区块号

### ⚡ 交易历史

**位置**：数据中心 → 交易历史

**功能说明**：
- 显示所有链上交易
- 支持多种筛选器
- 5分钟缓存机制

**操作方法**：
1. 点击 "加载交易历史"
2. 使用筛选器：
   - 全部：所有交易
   - 合约交易：通过合约的交易
   - 普通转账：直接 ETH 转账
   - 其他合约：与其他合约交互
   - 代币：ERC20/NFT 交易
3. 点击交易查看详情
4. 在 Etherscan 查看完整信息

**数据说明**：
- 🟣 紫色：本系统合约交易
- 🔵 蓝色：普通 ETH 转账
- 🟠 橙色：其他合约交互
- 🟢 绿色：代币交易

### 🔮 The Graph 查询

**位置**：The Graph 标签

**功能说明**：
- 使用 GraphQL 查询
- 支持自定义查询
- 两栏数据展示

**快速查询模板**：
1. **最近24小时**：查看一天内的活动
2. **我的记录**：只看自己的数据
3. **大额交易**：筛选大于 1 ETH 的交易
4. **最新活动**：最新 5 条记录

**自定义查询**：
1. 点击 "显示查询编辑器"
2. 输入 GraphQL 查询
3. 设置查询变量（JSON 格式）
4. 点击 "执行查询"
5. 查看结果

**查询示例**：
```graphql
query MyData($address: Bytes!) {
  dataRecords(
    where: { sender: $address }
    orderBy: timestamp
    orderDirection: desc
    first: 10
  ) {
    id
    category
    data
    timestamp
  }
}
```

## 交易管理

### 查看交易状态

**pending（待确认）**：
- 黄色标识
- 等待矿工打包
- 通常 15-30 秒

**confirmed（已确认）**：
- 绿色标识
- 交易成功
- 数据已上链

**failed（失败）**：
- 红色标识
- 可能原因：Gas 不足、网络错误
- 资金会退回

### 加速交易

如果交易长时间未确认：
1. 在 MetaMask 中找到待处理交易
2. 点击 "加速"
3. 增加 Gas 价格
4. 确认新交易

### 取消交易

只能取消未确认的交易：
1. 在 MetaMask 中找到待处理交易
2. 点击 "取消"
3. 支付取消费用
4. 等待确认

## 高级功能

### 自动刷新

**位置**：数据中心 → 自动刷新控制

**设置选项**：
- 刷新间隔：5秒到5分钟
- 区块监听：实时监听新区块
- 可随时开关

**注意**：频繁刷新会消耗更多 API 配额

### 数据导出

**当前方法**：
1. 打开浏览器开发者工具（F12）
2. 在 Console 中查看数据
3. 复制 JSON 数据
4. 保存到本地文件

**未来功能**：
- CSV 导出
- JSON 下载
- PDF 报告

### 批量操作

**批量上传**（开发中）：
- 上传 CSV 文件
- 自动分批处理
- 进度显示

## 费用说明

### Gas 费用估算

| 操作类型 | Gas 使用量 | 费用估算（Sepolia） |
|---------|-----------|-------------------|
| 日志上传 | ~50,000 | ~0.001 ETH |
| 合约转账 | ~80,000 | ~0.0016 ETH |
| 原生转账 | 21,000 | ~0.00042 ETH |
| 数据查询 | 0 | 免费 |

### 影响 Gas 的因素

1. **数据大小**
   - 数据越大，Gas 越高
   - 建议压缩大文件

2. **网络拥堵**
   - 高峰期 Gas 价格上涨
   - 可选择空闲时段操作

3. **交易复杂度**
   - 简单转账最便宜
   - 合约调用较贵

### 节省 Gas 技巧

1. **批量处理**
   - 合并多个操作
   - 减少交易次数

2. **选择时机**
   - 避开网络高峰
   - 周末通常较便宜

3. **优化数据**
   - 压缩数据
   - 使用简短标识

## 安全提示

### ⚠️ 重要警告

1. **私钥安全**
   - 永远不要分享私钥
   - 不要在网站输入私钥
   - 使用硬件钱包更安全

2. **交易确认**
   - 仔细检查接收地址
   - 确认转账金额
   - 查看 Gas 费用

3. **数据隐私**
   - 上链数据公开可见
   - 不要上传敏感信息
   - 考虑加密重要数据

### 🛡️ 最佳实践

1. **测试先行**
   - 先在测试网练习
   - 小额测试功能
   - 确认无误再正式使用

2. **备份重要信息**
   - 保存交易哈希
   - 记录重要地址
   - 备份数据原文

3. **定期检查**
   - 查看交易历史
   - 验证数据完整性
   - 监控异常活动

### 🚨 遇到问题

**资金丢失**：
- 检查交易哈希
- 确认接收地址
- 联系技术支持

**数据错误**：
- 数据上链后不可修改
- 只能重新上传更正
- 保留原始记录

**账户异常**：
- 立即停止使用
- 转移剩余资金
- 更换新账户

## 常见问题

### Q1: 为什么连接不上钱包？
- 确保 MetaMask 已解锁
- 刷新页面重试
- 检查网络连接

### Q2: 交易失败怎么办？
- 检查余额是否充足
- 增加 Gas 限制
- 重新发送交易

### Q3: 数据能删除吗？
- 区块链数据不可删除
- 不可修改
- 永久保存

### Q4: 支持哪些文件类型？
- 文本文件
- JSON 数据
- Base64 编码
- 任何可转换为字符串的内容

### Q5: 主网什么时候支持？
- 目前仅支持测试网
- 主网版本开发中
- 请关注更新公告

## 获取帮助

### 📞 联系方式
- GitHub Issues：[提交问题]
- Email：support@example.com
- Discord：[社区链接]

### 📖 更多资源
- [技术文档](./README.md)
- [部署指南](./DEPLOYMENT.md)
- [API 文档](./API.md)
- [视频教程]（即将推出）

### 🔄 版本更新
- 当前版本：v1.0.0
- 更新日期：2024-01-01
- [更新日志](./CHANGELOG.md)

---

感谢使用我们的系统！如有任何问题，请随时联系我们。
